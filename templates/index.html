<!DOCTYPE html>
<html>
<head>
  <title>Slits n Dicks :3</title>
  <style>
    /* Basic Dark Mode Styling (keep your existing styles) */
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background-color: #111111; /* Dark background */
      color: #509E3F; /* Green text color */
      padding: 20px; /* Add some padding for spacing */
      padding-bottom: 40px; /* Add padding to the bottom */
      box-sizing: border-box; /* Include padding in element's total width and height */
    }

    h1 {
        color: #509E3F; /* Green heading */
        margin-bottom: 20px;
    }

    img {
      max-width: 90%;
      max-height: 70vh;
      height: auto; /* Maintain aspect ratio */
      margin-bottom: 20px;
      border: 1px solid #509E3F; /* Green border */
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5); /* More prominent shadow */
      display: block; /* Prevent extra space below image */
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 20px;
      background-color: #509E3F; /* Green button background */
      color: #111111; /* Dark button text */
      border: none;
      font-weight: bold;
      border-radius: 5px;
      transition: background-color 0.3s ease; /* Smooth transition on hover */
    }

    button:hover {
        background-color: #3c7830; /* Darker green on hover */
    }

    #sourceInfo {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid #509E3F; /* Green border */
        background-color: #222; /* Dark background */
        color: #509E3F; /* Green text */
        width: 100%; /* Occupy full width of container */
        max-width: 600px; /* Limit maximum width */
        text-align: left;
        border-radius: 8px;
        box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4);
        margin-bottom: 20px; /* Add spacing below source info */
    }

    #sourceInfo p {
        margin: 5px 0;
        word-wrap: break-word; /* Prevent long URLs from overflowing */
    }

    #sourceInfo a {
        color: #7cbe6c; /* Lighter green link color */
        text-decoration: none;
    }

    #sourceInfo a:hover {
        text-decoration: underline;
        color: #a0e090; /* Even lighter green on hover */
    }

    /* Style for the Source Information title and labels */
    #sourceInfo p:first-child, /* Target the first paragraph (the title) */
    #sourceInfo strong {      /* Target the strong tags (the labels) */
        color: #509E3F; /* Match our green theme */
    }


    /* Optional: Style for error messages */
    #sourceInfo p[style*="color: red"] {
        color: #ff6b6b !important; /* Reddish error text */
    }


  </style>
</head>
<body>
  <h1>Slits n Dicks :3</h1>

  <img id="randomImage" src="" alt="Random Image">
  <button id="spiceButton">Random Spice</button>

  <div id="sourceInfo">
    <p>Source Information:</p>
    <p id="sourceLink"></p>
    <p id="artistInfo"></p>
    <p id="similarityInfo"></p>
  </div>


  <script>
    const randomImageElement = document.getElementById('randomImage');
    const spiceButton = document.getElementById('spiceButton');
    const sourceInfoDiv = document.getElementById('sourceInfo');
    const sourceLinkElement = document.getElementById('sourceLink');
    const artistInfoElement = document.getElementById('artistInfo');
    const similarityInfoElement = document.getElementById('similarityInfo');


    const fetchRandomImageAndSource = () => {
        sourceInfoDiv.innerHTML = '<p>Loading image and source info...</p>'; // Loading indicator

        // Reset source info content to only the title
        sourceLinkElement.innerHTML = '';
        artistInfoElement.innerHTML = '';
        similarityInfoElement.innerHTML = '';


        fetch('/random-image-with-source') // New endpoint in Flask
            .then(response => {
                if (!response.ok) {
                     // Attempt to read error message from server
                     return response.json().then(err => { throw new Error(`HTTP error! status: ${response.status}, Message: ${err.error || response.statusText}`); });
                }
                return response.json();
            })
            .then(data => {
                if (data.imageUrl) {
                    randomImageElement.src = data.imageUrl;

                    // Display source information
                    if (data.source_results && data.source_results.length > 0) {
                         const result = data.source_results[0]; // Display the top result
                         sourceInfoDiv.innerHTML = '<p>Source Information:</p>'; // Clear loading message and keep title

                         sourceLinkElement.innerHTML = `<strong>Source:</strong> <a href="${result.source_url}" target="_blank">${result.source_url}</a>`;
                         artistInfoElement.innerHTML = `<strong>Artist:</strong> ${result.artist}`;
                         similarityInfoElement.innerHTML = `<strong>Similarity:</strong> ${result.similarity}%`;

                         sourceInfoDiv.appendChild(sourceLinkElement);
                         sourceInfoDiv.appendChild(artistInfoElement);
                         sourceInfoDiv.appendChild(similarityInfoElement);

                    } else {
                        sourceInfoDiv.innerHTML = '<p>Source Information:</p><p>No source information found on SauceNao.</p>';
                    }
                } else {
                     sourceInfoDiv.innerHTML = `<p style="color: red;">Error: No image URL received: ${data.error || 'Unknown error'}</p>`; // Display more specific error
                }
            })
            .catch(error => {
                sourceInfoDiv.innerHTML = `<p style="color: red;">Error fetching image and source: ${error.message}</p>`; // Display fetch error
            });
    };

    spiceButton.addEventListener('click', fetchRandomImageAndSource);


    // Load a random image and source info when the page loads initially
    document.addEventListener('DOMContentLoaded', fetchRandomImageAndSource);
  </script>
</body>
</html>
